C51 COMPILER V9.02   DS18B20                                                               03/31/2018 10:37:23 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN ..\output\ds18b20.obj
COMPILER INVOKED BY: F:\KEIL4\C51\BIN\C51.EXE ..\source\ds18b20.c COMPACT BROWSE DEBUG OBJECTEXTEND PRINT(..\output\ds18
                    -b20.lst) OBJECT(..\output\ds18b20.obj)

line level    source

   1          #include "config.h"
   2          
   3          void Delay(u8 us)
   4          {
   5   1              do{
   6   2                      _nop_();
   7   2                      _nop_();
   8   2                      _nop_();
   9   2                      _nop_();
  10   2                      _nop_();
  11   2                      _nop_();
  12   2                      _nop_();
  13   2                      _nop_();
  14   2              }while(--us);
  15   1      }
  16          
  17          bit Get18B20ACK()
  18          {
  19   1              bit ack;
  20   1      
  21   1      //      EA = 0;
  22   1              DS18B20_IO = 0;
  23   1              Delay(250);
  24   1              Delay(250);
  25   1              DS18B20_IO = 1;
  26   1              Delay(60);
  27   1              ack = DS18B20_IO;
  28   1              while(!DS18B20_IO);
  29   1      //      EA = 1;
  30   1              
  31   1              return ack;     
  32   1      }
  33          
  34          void DS18B20Write(u8 dat)
  35          {
  36   1              u8 mask;
  37   1              
  38   1      //      EA = 0;
  39   1              for(mask=0x01; mask!=0; mask<<=1)
  40   1              {
  41   2                      DS18B20_IO = 0;
  42   2                      Delay(2);
  43   2                      if(dat&mask)
  44   2                      {
  45   3                              DS18B20_IO = 1;
  46   3                      }
  47   2                      else
  48   2                      {
  49   3                              DS18B20_IO = 0;
  50   3                      }
  51   2                      Delay(60);
  52   2                      DS18B20_IO = 1;
  53   2              }
  54   1      //      EA = 1; 
C51 COMPILER V9.02   DS18B20                                                               03/31/2018 10:37:23 PAGE 2   

  55   1      }
  56          
  57          u8 DS18B20Read()
  58          {
  59   1              u8 mask, dat=0;
  60   1      
  61   1      //      EA = 0;
  62   1              for(mask=0x01; mask!=0; mask<<=1)
  63   1              {
  64   2                      DS18B20_IO = 0;
  65   2                      Delay(2);
  66   2                      DS18B20_IO = 1;
  67   2                      Delay(2);
  68   2                      if(DS18B20_IO)
  69   2                      {
  70   3                              dat |= mask;    
  71   3                      }
  72   2                      Delay(60);
  73   2              }
  74   1      //      EA = 1;
  75   1      
  76   1              return dat;
  77   1      }
  78          
  79          bit Start18B20()
  80          {
  81   1              bit ack;
  82   1      
  83   1              ack = Get18B20ACK();
  84   1              if(ack == 0)
  85   1              {
  86   2                      DS18B20Write(0xCC);
  87   2                      DS18B20Write(0x44);
  88   2              }
  89   1      
  90   1              return ~ack;
  91   1      }
  92          
  93          bit Get18B20Temp(int *temp)
  94          {
  95   1              bit ack;
  96   1              u8 LSB, MSB;
  97   1      
  98   1              ack = Get18B20ACK();
  99   1              if(ack == 0)
 100   1              {
 101   2                      DS18B20Write(0xCC);
 102   2                      DS18B20Write(0xBE);
 103   2                      LSB = DS18B20Read();
 104   2                      MSB = DS18B20Read();
 105   2                      *temp = ((u16)MSB<<8) + LSB;
 106   2              }
 107   1              
 108   1              return ~ack;
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    185    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.02   DS18B20                                                               03/31/2018 10:37:23 PAGE 3   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
