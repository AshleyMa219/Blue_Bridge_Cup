C51 COMPILER V9.02   MAIN                                                                  03/17/2018 11:16:10 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\output\main.obj
COMPILER INVOKED BY: F:\KEIL4\C51\BIN\C51.EXE ..\source\main.c COMPACT BROWSE DEBUG OBJECTEXTEND PRINT(..\output\main.ls
                    -t) OBJECT(..\output\main.obj)

line level    source

   1          /*
   2          *******************************************************************************
   3          * 文件名：main.c
   4          * 描  述：
   5          * 作  者：CLAY
   6          * 版本号：v1.0.0
   7          * 日  期: 
   8          * 备  注：使用蓝桥的底层!
   9          *         
  10          *******************************************************************************
  11          */
  12          
  13          #include "config.h"
  14          #include "ds1302.h"
  15          
  16          u8 T0RH = 0;
  17          u8 T0RL = 0;
  18          bit flag200ms = 0;
  19          
  20          u8 code LedChar[] = {
  21                  0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,
  22                  0x80,0x90,0x88,0x83,0xC6,0xA1,0x86,0x8E
  23          };
  24          u8 LedBuff[] = {
  25                  0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
  26          };
  27          
  28          
  29          void ConfigTimer0(u16 ms);
  30          void CloseFucker();
  31          
  32          void main()
  33          {
  34   1              u8 i;
  35   1              u8 psec = 0xAA;
  36   1              u8 time[8];
  37   1      
  38   1              EA = 1;
  39   1              CloseFucker();
  40   1              ConfigTimer0(1);
  41   1              InitDS1302();
  42   1              
  43   1              LedBuff[2] = 0xBF;
  44   1              LedBuff[5] = 0xBF;
  45   1      
  46   1              while(1)
  47   1              {
  48   2                      if(flag200ms)
  49   2                      {
  50   3                              flag200ms = 0;
  51   3                              for(i=0; i<7; i++)
  52   3                              {
  53   4                                      time[i] = DS1302SingleRead(i);
  54   4                              }
C51 COMPILER V9.02   MAIN                                                                  03/17/2018 11:16:10 PAGE 2   

  55   3                              if(psec != time[0])
  56   3                              {
  57   4                      LedBuff[7] = LedChar[time[2] >> 4];  //“时”
  58   4                      LedBuff[6] = LedChar[time[2]&0x0F];
  59   4                      LedBuff[4] = LedChar[time[1] >> 4];  //“分”
  60   4                      LedBuff[3] = LedChar[time[1]&0x0F];
  61   4                      LedBuff[1] = LedChar[time[0] >> 4];  //“秒”
  62   4                      LedBuff[0] = LedChar[time[0]&0x0F];
  63   4                      
  64   4                      psec = time[0];  //用当前值更新上次秒数
  65   4                              }
  66   3                      }               
  67   2              }
  68   1      }
  69          
  70          void CloseFucker()
  71          {
  72   1              P2 = (P2 & 0x1F) | 0xA0;
  73   1              P0 = P0 & 0xAF;
  74   1              P2 = P2&0x1F;
  75   1      }
  76          
  77          
  78          void ConfigTimer0(u16 ms)
  79          {
  80   1          u32 tmp; 
  81   1          
  82   1          tmp = 11059200 / 12;    
  83   1          tmp = (tmp * ms) / 1000;  
  84   1          tmp = 65536 - tmp;          
  85   1          T0RH = (u8)(tmp>>8);  
  86   1          T0RL = (u8)tmp;
  87   1          TMOD &= 0xF0;   
  88   1          TMOD |= 0x01;   
  89   1          TH0 = T0RH;     
  90   1          TL0 = T0RL;
  91   1          ET0 = 1;       
  92   1          TR0 = 1;       
  93   1      }
  94          void LedScan()
  95          {
  96   1              static u8 index = 0;
  97   1      
  98   1              P2 = (P2&0x1F) | 0xE0;
  99   1              P0 = 0xFF;
 100   1              P2 = P2&0x1F;
 101   1              P2 = (P2&0x1F) | 0xC0;
 102   1              P0 = 0x80>>index;
 103   1              P2 = P2&0x1F;
 104   1              P2 = (P2&0x1F) | 0xE0;
 105   1              P0 = LedBuff[index];
 106   1              P2 = P2&0x1F;
 107   1      
 108   1              index++;
 109   1              index &= 0x07;
 110   1      }
 111          
 112          void InterruptTimer0() interrupt 1
 113          {
 114   1          static unsigned char tmr200ms = 0;
 115   1          
 116   1          TH0 = T0RH; 
C51 COMPILER V9.02   MAIN                                                                  03/17/2018 11:16:10 PAGE 3   

 117   1          TL0 = T0RL;
 118   1              LedScan();
 119   1          tmr200ms++;
 120   1          if (tmr200ms >= 200) 
 121   1          {
 122   2              tmr200ms = 0;
 123   2              flag200ms = 1;
 124   2          }
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    400    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     12      14
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
